import{Q,d as l,G as z,o as a,c as T,w as J,a as s,i as j,e as i,F as A,h as B,f as m,m as v,p as _,t as g,q as x}from"./app-BcVz0gFs.js";import{_ as K}from"./AppLayout-BCxMC4vW.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"py-4"},P={class:"max-w mx-auto sm:px-6 lg:px-8"},R={class:"overflow-hidden sm:rounded-lg"},W={class:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4"},X={key:0},Y={class:"text-xl font-bold"},Z={key:0,class:"grid grid-cols-1 sm:grid-cols-3 md:grid-cols-5 gap-4"},ee={class:"block overflow-hidden"},oe={class:"flex justify-between items-center lg:flex-row flex-col"},te={class:"font-medium"},re=s("span",{class:"font-medium"},"Nombre:",-1),se=["onUpdate:modelValue"],ne={class:"flex items-center"},de=s("p",{class:"px-2"},"$",-1),le=["onUpdate:modelValue"],ae=["onUpdate:modelValue"],ie={key:0,class:"flex flex-col gap-1 mt-2 justify-center items-center"},ce=["onClick"],ue=["onClick"],pe={key:1,class:"text-red-500 mt-2"},me={key:0,class:"bg-white shadow border border-gray-300 rounded p-4 items-center flex"},ve={class:"block h-full"},_e=s("div",{class:"flex justify-between w-full items-center"},[s("span",{class:"font-medium text-gray-500"},"Nuevo item")],-1),be=["onUpdate:modelValue"],fe=["onUpdate:modelValue"],he=["onUpdate:modelValue"],ge={class:"flex justify-center items-center w-full mt-2"},xe=["onClick"],ye={key:0,class:"text-red-500 mt-2"},we={key:1,class:"py-4 my-8 border-t-2 flex flex-col w-fit gap-2"},ke=s("label",{for:"categoria"},"Nueva categoria:",-1),Ce={key:0,class:"text-red-500 text-center"},Ee={key:2,class:"w-full flex justify-end"},Ne=s("button",{type:"submit",class:"py-2 px-3 rounded-lg bg-orange-500 text-white font-bold"},"Actualizar Inventario",-1),Ve=[Ne],je={__name:"Inventario",setup(Ue){var N,V,U,$,S;const{props:p}=Q(),I=l(p.ingredientes||[]),q=l(p.bebidas||[]),k=l(p.ingredientesInventario||[]),C=l(p.bebidasInventario||[]),D=l(p.sucursal||"");l(""),l(""),l("");const c=z([]);console.log(p.categorias.length),p.categorias.forEach(e=>{c[e.id]={nombre:"",precio:"",cantidad:""},console.log(c)}),l(p.itemsporcat||[]);const b=l(""),E=l(p.categorias||[]),f=l({}),h=l(""),y=l({}),d=z({sucursal_id:D.value,ingredientes:((N=I.value)==null?void 0:N.map(e=>{var t;return{id:e==null?void 0:e.id,nombre:e==null?void 0:e.nombre,cantidad:((t=k.value.find(o=>(o==null?void 0:o.id)===(e==null?void 0:e.id)))==null?void 0:t.cantidad)||0,precio:(e==null?void 0:e.precio)||0}}))||[],bebidas:((V=q.value)==null?void 0:V.map(e=>{var t;return{id:e==null?void 0:e.id,nombre:e==null?void 0:e.nombre,cantidad:((t=C.value.find(o=>(o==null?void 0:o.id)===(e==null?void 0:e.id)))==null?void 0:t.cantidad)||0,precio:(e==null?void 0:e.precio)||0}}))||[],ingredientesInventario:((U=k.value)==null?void 0:U.map(e=>({id:e==null?void 0:e.id,nombre:e==null?void 0:e.nombre,cantidad:(e==null?void 0:e.cantidad)||0,precio:(e==null?void 0:e.precio)||0})))||[],bebidasInventario:(($=C.value)==null?void 0:$.map(e=>({id:e==null?void 0:e.id,nombre:e==null?void 0:e.nombre,cantidad:(e==null?void 0:e.cantidad)||0,precio:(e==null?void 0:e.precio)||0})))||[],categorias:((S=E.value)==null?void 0:S.map(e=>({id:e==null?void 0:e.id,nombre:e==null?void 0:e.nombre,items:(e==null?void 0:e.items.map(t=>({id:t==null?void 0:t.id,nombre:t==null?void 0:t.nombre,precio:(t==null?void 0:t.precio)||0,cantidad:(t==null?void 0:t.cantidad)||0})))||[]})))||[]}),F=()=>{console.log("Datos enviados:",d),x.post("/inventario",d,{onSuccess:()=>{console.log("Inventario actualizado con éxito")},onError:e=>{console.error("Error al actualizar el inventario:",e)}})},M=e=>{if(d.categorias.find(o=>o.id===e)){const{nombre:o,precio:r}=c[e]||{nombre:"",precio:""};if(!o||!r){y.value[e]="Nombre y precio son requeridos";return}x.post("/items",{categoria_id:e,nombre:o,precio:r},{onSuccess:n=>{c[e]={nombre:"",precio:""};const w=n.props.categorias.find(u=>u.id===e).items.slice(-1)[0];d.categorias=d.categorias.map(u=>u.id===e?{...u,items:[...u.items,w]}:u),delete y.value[e]},onError:n=>{console.error("Error al agregar el ítem:",n)}})}},G=(e,t)=>{x.delete(`/items/${t}`,{onSuccess:o=>{d.categorias=d.categorias.map(r=>r.id===e?{...r,items:r.items.filter(n=>n.id!==t)}:r),c[e]={nombre:"",precio:"",cantidad:""},console.log("Categorías después de eliminar:",d.categorias)},onError:o=>{console.error("Error al eliminar el ítem:",o)}})},H=(e,t)=>{const o=d.categorias.find(n=>n.id==e),r=o?o.items.find(n=>n.id==t):null;if(r){if(!r.nombre||r.nombre.trim()==""){f.value[t]="El nombre está vacío o solo contiene espacios";return}if(!r.precio||isNaN(r.precio)||Number(r.precio)==0){f.value[t]="El precio está vacío, no es válido o es 0";return}x.put(`/items/${t}`,r,{onSuccess:n=>{console.log("Item actualizado con éxito");const w=n.props.categorias.find(u=>u.id==e);w&&(d.categorias=d.categorias.map(u=>u.id==e?w:u)),delete f.value[t]},onError:n=>{console.error("Error al actualizar el ítem:",n)}})}},L=()=>{if(!b.value.trim()){h.value="El nombre de la categoría es requerido";return}const e={nombre:b.value.trim()};x.post("/categorias",e,{onSuccess:t=>{console.log("Categoría agregada con éxito");const o=t.props.categorias.slice(-1)[0];d.categorias=[...d.categorias,o],c[o.id]={nombre:"",precio:"",cantidad:""},b.value="",h.value=""},onError:t=>{console.error("Error al agregar la categoría:",t),h.value="Hubo un problema al agregar la categoría. Inténtalo de nuevo."}})};return(e,t)=>(a(),T(K,{title:"Inventario"},{default:J(()=>[s("div",O,[s("div",P,[s("div",R,[s("div",W,[s("form",{onSubmit:j(F,["prevent"])},[E.value?(a(),i("div",X,[(a(!0),i(A,null,B(d.categorias,o=>(a(),i("div",{key:o.id,class:"mb-4"},[s("h2",Y,g(o.nombre),1),o.items?(a(),i("div",Z,[(a(!0),i(A,null,B(o.items,r=>(a(),i("div",{key:r.id,class:"bg-white shadow rounded border border-gray-300 p-4"},[s("label",ee,[s("div",oe,[s("span",te,"Cantidad de "+g(r.cantidad)+":",1),re]),s("div",null,[v(s("input",{type:"text","onUpdate:modelValue":n=>r.nombre=n,class:"mt-1 block w-full border rounded p-2 border-gray-300"},null,8,se),[[_,r.nombre,void 0,{trim:!0}]]),s("div",ne,[de,v(s("input",{type:"number","onUpdate:modelValue":n=>r.precio=n,min:0,class:"mt-1 block w-full border rounded p-2 border-gray-300"},null,8,le),[[_,r.precio,void 0,{number:!0}]]),v(s("input",{type:"number","onUpdate:modelValue":n=>r.cantidad=n,class:"mt-1 block w-full border rounded p-2",min:0,step:"0.10"},null,8,ae),[[_,r.cantidad,void 0,{number:!0}]])])]),e.$page.props.auth.user.sucursal_id==0?(a(),i("div",ie,[s("span",{onClick:n=>H(o.id,r.id),class:"text-center w-fit text-xs px-10 py-2 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-lg cursor-pointer"},"Actualizar",8,ce),s("span",{onClick:n=>G(o.id,r.id),class:"text-center w-fit text-xs px-11 py-2 bg-red-500 hover:bg-red-600 text-white font-bold rounded-lg cursor-pointer"},"Eliminar",8,ue)])):m("",!0),f.value[o.id]?(a(),i("div",pe,g(f.value[o.id]),1)):m("",!0)])]))),128)),e.$page.props.auth.user.sucursal_id==0?(a(),i("div",me,[s("label",ve,[_e,v(s("input",{type:"text",placeholder:"Nombre del item",class:"mt-1 block w-full border border-gray-300 rounded p-2","onUpdate:modelValue":r=>c[o.id].nombre=r},null,8,be),[[_,c[o.id].nombre,void 0,{trim:!0}]]),v(s("input",{type:"number",placeholder:"$0.0",class:"mt-1 block w-full border border-gray-300 rounded p-2","onUpdate:modelValue":r=>c[o.id].precio=r,step:"0.10"},null,8,fe),[[_,c[o.id].precio,void 0,{number:!0}]]),v(s("input",{type:"number",placeholder:"0.0",class:"mt-1 block w-full border border-gray-300 rounded p-2","onUpdate:modelValue":r=>c[o.id].cantidad=r,step:"0.10"},null,8,he),[[_,c[o.id].cantidad,void 0,{number:!0}]]),s("div",ge,[s("span",{onClick:r=>M(o.id),class:"text-center text-xs px-10 py-2 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg cursor-pointer"},"Agregar",8,xe)]),y.value[o.id]?(a(),i("div",ye,g(y.value[o.id]),1)):m("",!0)])])):m("",!0)])):m("",!0)]))),128))])):m("",!0),e.$page.props.auth.user.sucursal_id===0?(a(),i("div",we,[ke,v(s("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>b.value=o),type:"text",class:"rounded-lg",placeholder:"Nombre"},null,512),[[_,b.value,void 0,{trim:!0}]]),s("span",{onClick:j(L,["prevent"]),class:"bg-blue-500 hover:bg-blue-600 cursor-pointer text-white px-4 py-2 rounded-xl text-center"}," Agregar "),h.value?(a(),i("div",Ce,g(h.value),1)):m("",!0)])):m("",!0),e.$page.props.auth.user.sucursal_id>0?(a(),i("div",Ee,Ve)):m("",!0)],32)])])])])]),_:1}))}};export{je as default};
